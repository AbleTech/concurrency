#!/bin/sh

mix local.hex --force
mix local.rebar --force
mix deps.get
mix compile

mkdir -p /app/tmp

ENV_NAME=dev
FILE=/app/tmp/db_init_$ENV_NAME
if [ ! -f "$FILE" ]; then
  echo "Creating and loading $ENV_NAME database"
  MIX_ENV=$ENV_NAME mix ecto.create
  MIX_ENV=$ENV_NAME mix ecto.load
  touch "$FILE"
fi

echo "Blocking with a tail command - press CTRL-C to break"
tail -f /dev/null
